<?xml version="1.0" encoding="UTF-8"?>
<rss  xmlns:atom="http://www.w3.org/2005/Atom" 
      xmlns:media="http://search.yahoo.com/mrss/" 
      xmlns:content="http://purl.org/rss/1.0/modules/content/" 
      xmlns:dc="http://purl.org/dc/elements/1.1/" 
      version="2.0">
<channel>
<title>G.R.'s Blog</title>
<link>https://grigolet.github.io/index.html</link>
<atom:link href="https://grigolet.github.io/index.xml" rel="self" type="application/rss+xml"/>
<description>A blog about data analysis, visualization and sometimes cooking.</description>
<image>
<url>https://grigolet.github.io/profile.png</url>
<title>G.R.'s Blog</title>
<link>https://grigolet.github.io/index.html</link>
</image>
<generator>quarto-1.1</generator>
<lastBuildDate>Sat, 17 Sep 2022 22:00:00 GMT</lastBuildDate>
<item>
  <title>My matplotlib stylesheet</title>
  <link>https://grigolet.github.io/posts/my-matplotlib-stylesheet/index.html</link>
  <description><![CDATA[ 




<section id="introduction" class="level1">
<h1>Introduction</h1>
<p>When working on R&amp;D of gasesous detectors I tend to produce lots of plots for internal group discussions, conference presentations and publication publishing. Since most of these plots shows performance relative to gaseous detectors and since I am based at CERN I get to see lot of similar plots made by some other groups using <a href="https://root.cern.ch/">ROOT</a>, the de-facto standard analysis tool for high energy physics.</p>
<p>If I really have to be honest I have never liked ROOT so much, although I understand it provides several useful tools, from plotting data and fitting functions to GUI toolkits. Most, if not all the plots regarding the discovery of the Higgs boson were produced using ROOT. The layout of ROOT plots is then recognized and approved by the majority of the community in high energy physics.</p>
<p>If we have to compare a default plot made using root versus a default plot made with matplotlib, this would be the result</p>
<div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb1-1"><span class="im" style="color: #00769E;">import</span> matplotlib.pyplot <span class="im" style="color: #00769E;">as</span> plt</span>
<span id="cb1-2"><span class="im" style="color: #00769E;">import</span> ROOT <span class="im" style="color: #00769E;">as</span> rt</span>
<span id="cb1-3"><span class="im" style="color: #00769E;">import</span> numpy <span class="im" style="color: #00769E;">as</span> np</span>
<span id="cb1-4"></span>
<span id="cb1-5">x <span class="op" style="color: #5E5E5E;">=</span> np.array([<span class="fl" style="color: #AD0000;">321.0</span>, <span class="fl" style="color: #AD0000;">860.0</span>, <span class="fl" style="color: #AD0000;">777.0</span>, <span class="fl" style="color: #AD0000;">562.0</span>, <span class="fl" style="color: #AD0000;">374.0</span>, <span class="fl" style="color: #AD0000;">132.0</span>, <span class="fl" style="color: #AD0000;">816.0</span>, <span class="fl" style="color: #AD0000;">220.0</span>, <span class="fl" style="color: #AD0000;">253.0</span>])</span>
<span id="cb1-6">y <span class="op" style="color: #5E5E5E;">=</span> np.array([<span class="fl" style="color: #AD0000;">134.0</span>,<span class="fl" style="color: #AD0000;">307.0</span>,<span class="fl" style="color: #AD0000;">299.0</span>,<span class="fl" style="color: #AD0000;">213.0</span>,<span class="fl" style="color: #AD0000;">135.0</span>,<span class="fl" style="color: #AD0000;">50.0</span>,<span class="fl" style="color: #AD0000;">297.0</span>,<span class="fl" style="color: #AD0000;">85.0</span>,<span class="fl" style="color: #AD0000;">95.0</span>])</span>
<span id="cb1-7"></span>
<span id="cb1-8"><span class="co" style="color: #5E5E5E;"># Let's just make sure we are using the default settings now</span></span>
<span id="cb1-9">plt.style.use(<span class="st" style="color: #20794D;">'default'</span>)</span>
<span id="cb1-10"></span>
<span id="cb1-11"><span class="co" style="color: #5E5E5E;"># Matplotlib</span></span>
<span id="cb1-12">fig, ax <span class="op" style="color: #5E5E5E;">=</span> plt.subplots()</span>
<span id="cb1-13">ax.<span class="bu" style="color: null;">set</span>(title<span class="op" style="color: #5E5E5E;">=</span><span class="st" style="color: #20794D;">'Rate vs. Currents'</span>, xlabel<span class="op" style="color: #5E5E5E;">=</span><span class="st" style="color: #20794D;">'Rate [Hz/cm$^2$]'</span>, ylabel<span class="op" style="color: #5E5E5E;">=</span><span class="st" style="color: #20794D;">'Currents [uA]'</span>)</span>
<span id="cb1-14">ax.plot(x, y, <span class="st" style="color: #20794D;">'.'</span>)</span>
<span id="cb1-15">ax.axhline(<span class="dv" style="color: #AD0000;">150</span>, color<span class="op" style="color: #5E5E5E;">=</span><span class="st" style="color: #20794D;">'r'</span>)</span>
<span id="cb1-16"></span>
<span id="cb1-17"><span class="co" style="color: #5E5E5E;"># ROOT</span></span>
<span id="cb1-18">canvas <span class="op" style="color: #5E5E5E;">=</span> rt.TCanvas(<span class="st" style="color: #20794D;">"rate_vs_current"</span>, <span class="st" style="color: #20794D;">"Rate vs. Currents"</span>)</span>
<span id="cb1-19">graph <span class="op" style="color: #5E5E5E;">=</span> rt.TGraph(<span class="bu" style="color: null;">len</span>(x), x, y)</span>
<span id="cb1-20">graph.SetTitle(<span class="st" style="color: #20794D;">"Rate vs. Currents"</span>)</span>
<span id="cb1-21">graph.SetMarkerStyle(<span class="dv" style="color: #AD0000;">7</span>)</span>
<span id="cb1-22">graph.GetXaxis().SetTitle(<span class="st" style="color: #20794D;">"Rate [Hz/cm^</span><span class="sc" style="color: #5E5E5E;">{2}</span><span class="st" style="color: #20794D;">]"</span>)</span>
<span id="cb1-23">graph.GetYaxis().SetTitle(<span class="st" style="color: #20794D;">"Currents [uA]"</span>)</span>
<span id="cb1-24">line <span class="op" style="color: #5E5E5E;">=</span> rt.TLine(graph.GetXaxis().GetXmin(), <span class="dv" style="color: #AD0000;">150</span>, graph.GetXaxis().GetXmax(), <span class="dv" style="color: #AD0000;">150</span>)</span>
<span id="cb1-25">line.SetLineColor(rt.kRed)</span>
<span id="cb1-26">graph.Draw(<span class="st" style="color: #20794D;">'AP'</span>)</span>
<span id="cb1-27">line.Draw(<span class="st" style="color: #20794D;">"L"</span>)</span>
<span id="cb1-28">canvas.Draw()</span></code></pre></div>
</details>
<div class="cell quarto-layout-panel" data-execution_count="14">
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="cell-output cell-output-display quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<div id="fig-default-matplotlib" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="https://grigolet.github.io/posts/my-matplotlib-stylesheet/index_files/figure-html/fig-default-matplotlib-output-1.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;1: Default matplotlib plot</figcaption><p></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<div id="fig-default-matplotlib" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="https://grigolet.github.io/posts/my-matplotlib-stylesheet/index_files/figure-html/fig-default-matplotlib-output-2.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;2: Default ROOT plot</figcaption><p></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="styling-matplotlib-plots" class="level1">
<h1>Styling matplotlib plots</h1>
<p>My goal here is to have the matplotlib plot to look a bit more like the ROOT one. I recently came to find that there is a python package called <a href="https://github.com/scikit-hep/mplhep">mplhep</a> that is aiming at producing ROOT-like style plots used in high energy physics. I found the package to be really helpful, especially when there is the need to add some labels regarding collaborations. However, in my particular case, I noticed that the default axes ticks, labels, spines layout were matching more matplotlib defaults than ROOT ones.</p>
<p>Before I came to know <code>mplhep</code> I decided to create my own <a href="https://matplotlib.org/stable/tutorials/introductory/customizing.html#matplotlibrc-sample">matplotlibrc</a> file, which, as the name may suggest, is a file containing defaults used to style matplotlib plots.</p>
<p>If you have a look at the default <code>matplotlibrc</code> content, you could see that it is organized in sections. Within each section you can find a set of defaults.</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>default_matplotlibrc.txt</strong></pre>
</div>
<div class="sourceCode" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode numberSource txt number-lines code-with-copy"><code class="sourceCode default"><span id="cb2-1">...</span>
<span id="cb2-2">## Matplotlib configuration are currently divided into following parts:</span>
<span id="cb2-3">##     - BACKENDS</span>
<span id="cb2-4">##     - LINES</span>
<span id="cb2-5">##     - PATCHES</span>
<span id="cb2-6">##     - HATCHES</span>
<span id="cb2-7">##     - BOXPLOT</span>
<span id="cb2-8">##     - FONT</span>
<span id="cb2-9">##     - TEXT</span>
<span id="cb2-10">##     - LaTeX</span>
<span id="cb2-11">##     - AXES</span>
<span id="cb2-12">##     - DATES</span>
<span id="cb2-13">##     - TICKS</span>
<span id="cb2-14">##     - GRIDS</span>
<span id="cb2-15">##     - LEGEND</span>
<span id="cb2-16">##     - FIGURE</span>
<span id="cb2-17">##     - IMAGES</span>
<span id="cb2-18">##     - CONTOUR PLOTS</span>
<span id="cb2-19">##     - ERRORBAR PLOTS</span>
<span id="cb2-20">##     - HISTOGRAM PLOTS</span>
<span id="cb2-21">##     - SCATTER PLOTS</span>
<span id="cb2-22">##     - AGG RENDERING</span>
<span id="cb2-23">##     - PATHS</span>
<span id="cb2-24">##     - SAVING FIGURES</span>
<span id="cb2-25">##     - INTERACTIVE KEYMAPS</span>
<span id="cb2-26">##     - ANIMATION</span>
<span id="cb2-27">...</span></code></pre></div>
</div>
<p>I will detail the sections that I have modified to make plots look more like ROOT ones.</p>
<section id="lines" class="level2">
<h2 class="anchored" data-anchor-id="lines">LINES</h2>
<p>In the <code>LINES</code> section the only default value that I have changed is the <code>lines.linewidth</code> set to 0.5, instead of the 1.5 default value.</p>
</section>
<section id="patches" class="level2">
<h2 class="anchored" data-anchor-id="patches">PATCHES</h2>
<p>In the <code>PATCHES</code> section I have also decrease the <code>patch.linewidth</code> to 0.5</p>
</section>
<section id="font" class="level2">
<h2 class="anchored" data-anchor-id="font">FONT</h2>
<p>For the font I haven’t found any easy way to add a web font into matplotlib without adding some lines of code. For this reason I have installed GNU Free font and modified the order of the <code>sans-serif</code> font to be: <code>Helvetica, FreeSans, Nimbus Sans, DejaVu Sans, Bitstream Vera Sans, Computer Modern Sans Serif, Lucida Grande, Verdana, Geneva, Lucid, Arial, Avant Garde, sans-serif</code></p>
<p>In the <code>FONT</code> section I have set <code>font.weight</code> to <code>regular</code> by default.</p>
</section>
<section id="axes-and-axis" class="level2">
<h2 class="anchored" data-anchor-id="axes-and-axis">AXES and AXIS</h2>
<p>In the <code>AXES</code> and <code>AXIS</code> sections I tweaked multiple lines. I will report only the modified lines:</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>my_matplotlibrc.txt</strong></pre>
</div>
<div class="sourceCode" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode numberSource txt number-lines code-with-copy"><code class="sourceCode default"><span id="cb3-1"># AXES</span>
<span id="cb3-2">axes.grid           : False   ## display grid or not</span>
<span id="cb3-3">axes.labelsize      : x-large  ## fontsize of the x any y labels</span>
<span id="cb3-4">axes.labelweight    : regular  ## weight of the x and y labels</span>
<span id="cb3-5">axes.formatter.useoffset      : False    ## If True, the tick label formatter</span>
<span id="cb3-6">axes.formatter.offset_threshold : 2     ## When useoffset is True, the offset</span>
<span id="cb3-7">...</span>
<span id="cb3-8"># AXIS</span>
<span id="cb3-9">xaxis.labellocation: right  # alignment of the xaxis label: {left, right, center}</span>
<span id="cb3-10">yaxis.labellocation: top  # alignment of the yaxis label: {bottom, top, center}</span></code></pre></div>
</div>
</section>
<section id="ticks" class="level2">
<h2 class="anchored" data-anchor-id="ticks">TICKS</h2>
<p>Matplotlib’s tick layout is what differs the most from ROOT default’s style. In this case the modified lines were the following:</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>my_matplotlibrc.txt</strong></pre>
</div>
<div class="sourceCode" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode numberSource txt number-lines code-with-copy"><code class="sourceCode default"><span id="cb4-1">xtick.top            : True  ## draw ticks on the top side</span>
<span id="cb4-2">xtick.major.size     : 8    ## major tick size in points</span>
<span id="cb4-3">xtick.minor.size     : 4      ## minor tick size in points</span>
<span id="cb4-4">xtick.major.width    : 0.5    ## major tick width in points</span>
<span id="cb4-5">xtick.minor.width    : 0.5    ## minor tick width in points</span>
<span id="cb4-6">xtick.major.pad      : 6    ## distance to major tick label in points</span>
<span id="cb4-7">xtick.direction      : in    ## direction: in, out, or inout</span>
<span id="cb4-8">xtick.minor.visible  : True  ## visibility of minor ticks on x-axis</span>
<span id="cb4-9">ytick.right          : True   ## draw ticks on the right side</span>
<span id="cb4-10">ytick.major.size     : 8      ## major tick size in points</span>
<span id="cb4-11">ytick.minor.size     : 4      ## minor tick size in points</span>
<span id="cb4-12">ytick.major.width    : 0.5    ## major tick width in points</span>
<span id="cb4-13">ytick.minor.width    : 0.5    ## minor tick width in points</span>
<span id="cb4-14">ytick.major.pad      : 6    ## distance to major tick label in points</span>
<span id="cb4-15">ytick.direction      : in     ## direction: in, out, or inout</span>
<span id="cb4-16">ytick.minor.visible  : True  ## visibility of minor ticks on y-axis</span></code></pre></div>
</div>
</section>
<section id="grid" class="level2">
<h2 class="anchored" data-anchor-id="grid">GRID</h2>
<p>Although I used to love grid, they might make the plot a bit “heavy” to read when there are several points and lines. For this reason I kept grids disabled:</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>my_matplotlibrc.txt</strong></pre>
</div>
<div class="sourceCode" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode numberSource txt number-lines code-with-copy"><code class="sourceCode default"><span id="cb5-1">grid.color       :   k    ## black</span>
<span id="cb5-2">grid.linestyle   :   --         ## dashed</span>
<span id="cb5-3">grid.linewidth   :   0.5       ## in points</span></code></pre></div>
</div>
</section>
<section id="legend" class="level2">
<h2 class="anchored" data-anchor-id="legend">LEGEND</h2>
<p>Regardin the legend handling I got some inspirations by having a look at some common plots used within the community I am working with:</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>my_matplotlibrc.txt</strong></pre>
</div>
<div class="sourceCode" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode numberSource txt number-lines code-with-copy"><code class="sourceCode default"><span id="cb6-1">legend.frameon       : True     ## if True, draw the legend on a background patch</span>
<span id="cb6-2">legend.framealpha    : None      ## legend patch transparency</span>
<span id="cb6-3">legend.edgecolor     : inherit      ## background patch boundary color</span>
<span id="cb6-4">legend.fancybox      : False     ## if True, use a rounded box for the</span>
<span id="cb6-5">                                 ## legend background, else a rectangle</span>
<span id="cb6-6">legend.scatterpoints : 3        ## number of scatter points</span>
<span id="cb6-7">legend.fontsize      : large</span>
<span id="cb6-8">legend.handlelength  : 0.7      ## the length of the legend lines</span>
<span id="cb6-9">legend.handleheight  : 1      ## the height of the legend handle</span>
<span id="cb6-10">legend.handletextpad : 1.2      ## the space between the legend line and legend text</span>
<span id="cb6-11">legend.borderaxespad : 1      ## the border between the axes and legend edge</span></code></pre></div>
</div>
</section>
<section id="figure" class="level2">
<h2 class="anchored" data-anchor-id="figure">FIGURE</h2>
<p>Although there are really no standard on the figure sizes I like a default 3:2 ratio and a minimum DPI of 300:</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>my_matplotlibrc.txt</strong></pre>
</div>
<div class="sourceCode" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode numberSource txt number-lines code-with-copy"><code class="sourceCode default"><span id="cb7-1">figure.figsize   : 6, 4       ## figure size in inches</span>
<span id="cb7-2">figure.dpi       : 300        ## figure dots per inch</span></code></pre></div>
</div>
</section>
<section id="other-tweakings" class="level2">
<h2 class="anchored" data-anchor-id="other-tweakings">Other tweakings</h2>
<p>I have set the cap size of the error bars, as by default is 0 and set the histogram binning to <code>"auto"</code>:</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>my_matplotlibrc.txt</strong></pre>
</div>
<div class="sourceCode" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode numberSource txt number-lines code-with-copy"><code class="sourceCode default"><span id="cb8-1">errorbar.capsize : 1.5            ## length of end cap on error bars in pixels</span>
<span id="cb8-2">hist.bins : auto                 ## The default number of histogram bins.</span>
<span id="cb8-3">                                  ## If Numpy 1.11 or later is</span>
<span id="cb8-4">                                  ## installed, may also be `auto`</span></code></pre></div>
</div>
</section>
</section>
<section id="final-results" class="level1">
<h1>Final results</h1>
<p>If I try to make again the plot in Figure Figure&nbsp;2 with these new defaults and put it side by side to a ROOT plot I get something like this:</p>
<div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb9-1"><span class="im" style="color: #00769E;">import</span> matplotlib.pyplot <span class="im" style="color: #00769E;">as</span> plt</span>
<span id="cb9-2"><span class="im" style="color: #00769E;">import</span> ROOT <span class="im" style="color: #00769E;">as</span> rt</span>
<span id="cb9-3"><span class="im" style="color: #00769E;">import</span> numpy <span class="im" style="color: #00769E;">as</span> np</span>
<span id="cb9-4"></span>
<span id="cb9-5">x <span class="op" style="color: #5E5E5E;">=</span> np.array([<span class="fl" style="color: #AD0000;">321.0</span>, <span class="fl" style="color: #AD0000;">860.0</span>, <span class="fl" style="color: #AD0000;">777.0</span>, <span class="fl" style="color: #AD0000;">562.0</span>, <span class="fl" style="color: #AD0000;">374.0</span>, <span class="fl" style="color: #AD0000;">132.0</span>, <span class="fl" style="color: #AD0000;">816.0</span>, <span class="fl" style="color: #AD0000;">220.0</span>, <span class="fl" style="color: #AD0000;">253.0</span>])</span>
<span id="cb9-6">y <span class="op" style="color: #5E5E5E;">=</span> np.array([<span class="fl" style="color: #AD0000;">134.0</span>,<span class="fl" style="color: #AD0000;">307.0</span>,<span class="fl" style="color: #AD0000;">299.0</span>,<span class="fl" style="color: #AD0000;">213.0</span>,<span class="fl" style="color: #AD0000;">135.0</span>,<span class="fl" style="color: #AD0000;">50.0</span>,<span class="fl" style="color: #AD0000;">297.0</span>,<span class="fl" style="color: #AD0000;">85.0</span>,<span class="fl" style="color: #AD0000;">95.0</span>])</span>
<span id="cb9-7"></span>
<span id="cb9-8"><span class="co" style="color: #5E5E5E;"># Use a context manager to plot only this plot with newer values</span></span>
<span id="cb9-9">plt.style.use(<span class="st" style="color: #20794D;">'https://gitlab.cern.ch/-/snippets/2223/raw/master/rpcecogas.mplstyle'</span>)</span>
<span id="cb9-10">fig, ax <span class="op" style="color: #5E5E5E;">=</span> plt.subplots()</span>
<span id="cb9-11">ax.<span class="bu" style="color: null;">set</span>(title<span class="op" style="color: #5E5E5E;">=</span><span class="st" style="color: #20794D;">'Rate vs. Currents'</span>, xlabel<span class="op" style="color: #5E5E5E;">=</span><span class="st" style="color: #20794D;">'Rate [Hz/cm$^2$]'</span>, ylabel<span class="op" style="color: #5E5E5E;">=</span><span class="st" style="color: #20794D;">'Currents [uA]'</span>)</span>
<span id="cb9-12">ax.plot(x, y, <span class="st" style="color: #20794D;">'.'</span>)</span>
<span id="cb9-13">ax.axhline(<span class="dv" style="color: #AD0000;">150</span>, color<span class="op" style="color: #5E5E5E;">=</span><span class="st" style="color: #20794D;">'r'</span>)</span>
<span id="cb9-14"></span>
<span id="cb9-15"><span class="co" style="color: #5E5E5E;"># ROOT</span></span>
<span id="cb9-16">canvas <span class="op" style="color: #5E5E5E;">=</span> rt.TCanvas(<span class="st" style="color: #20794D;">"rate_vs_current"</span>, <span class="st" style="color: #20794D;">"Rate vs. Currents"</span>)</span>
<span id="cb9-17">graph <span class="op" style="color: #5E5E5E;">=</span> rt.TGraph(<span class="bu" style="color: null;">len</span>(x), x, y)</span>
<span id="cb9-18">graph.SetTitle(<span class="st" style="color: #20794D;">"Rate vs. Currents"</span>)</span>
<span id="cb9-19">graph.SetMarkerStyle(<span class="dv" style="color: #AD0000;">7</span>)</span>
<span id="cb9-20">graph.GetXaxis().SetTitle(<span class="st" style="color: #20794D;">"Rate [Hz/cm^</span><span class="sc" style="color: #5E5E5E;">{2}</span><span class="st" style="color: #20794D;">]"</span>)</span>
<span id="cb9-21">graph.GetYaxis().SetTitle(<span class="st" style="color: #20794D;">"Currents [uA]"</span>)</span>
<span id="cb9-22">line <span class="op" style="color: #5E5E5E;">=</span> rt.TLine(graph.GetXaxis().GetXmin(), <span class="dv" style="color: #AD0000;">150</span>, graph.GetXaxis().GetXmax(), <span class="dv" style="color: #AD0000;">150</span>)</span>
<span id="cb9-23">line.SetLineColor(rt.kRed)</span>
<span id="cb9-24">graph.Draw(<span class="st" style="color: #20794D;">'AP'</span>)</span>
<span id="cb9-25">line.Draw(<span class="st" style="color: #20794D;">"L"</span>)</span>
<span id="cb9-26">canvas.Draw()</span></code></pre></div>
</details>
<div class="cell quarto-layout-panel" data-execution_count="15">
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="cell-output cell-output-display quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<div id="fig-new-default-matplotlib" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="https://grigolet.github.io/posts/my-matplotlib-stylesheet/index_files/figure-html/fig-new-default-matplotlib-output-1.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;3: Custom matplotlib plot</figcaption><p></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<div id="fig-new-default-matplotlib" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="https://grigolet.github.io/posts/my-matplotlib-stylesheet/index_files/figure-html/fig-new-default-matplotlib-output-2.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;4: Default ROOT plot</figcaption><p></p>
</figure>
</div>
</div>
</div>
</div>
</div>
<p>As you can notice in Figure&nbsp;4, the plots look similar. I have left a bigger x and y label titles for better readability and I have left the default <code>tab10</code> matplotlib palette for colors, as I don’t like the palette handling in ROOT.</p>
<p>You can find the stylesheet I am currently using available as a gitlab snippet here: https://gitlab.cern.ch/-/snippets/2223 There are couple of ways to use a stylesheet. The first, that applies globally, is to use <code>plt.style.use(url)</code>. The second instead, could be using a context manager provided by matplotlib that allows to apply styles on a plot within the context manager itself. For more information, see the <a href="https://matplotlib.org/stable/api/_as_gen/matplotlib.pyplot.rc_context.html">matplotlib documentation on <code>rc_context</code></a> There is only one caveat that I noticed when writing this post: if I use <code>rc_context</code> then I have some issues loading the system’s font and the plot will fallback to some defaults fonts. I don’t know if this is a matplotlib bug or if it is related to my local machine. I will have to investigate</p>
</section>
<section id="conclusions" class="level1">
<h1>Conclusions</h1>
<p>In this post I highlighted the matplotlib configuration I changed to have default plots looking more like ROOT. I am making a heavy use of these styles and I have observed that very few people notice that difference between a ROOT like plot and one made with these defaults.</p>
<p>In the future I plan to revise a little bit the configuration to further improve the layout.</p>


</section>

 ]]></description>
  <category>python</category>
  <category>matplotlib</category>
  <category>plot</category>
  <category>visualization</category>
  <category>style</category>
  <guid>https://grigolet.github.io/posts/my-matplotlib-stylesheet/index.html</guid>
  <pubDate>Sat, 17 Sep 2022 22:00:00 GMT</pubDate>
  <media:content url="https://grigolet.github.io/posts/my-matplotlib-stylesheet/preview.png" medium="image" type="image/png" height="106" width="144"/>
</item>
<item>
  <title>Multiple Y axes with matplotlib</title>
  <link>https://grigolet.github.io/posts/plots-with-multiple-y-axes/index.html</link>
  <description><![CDATA[ 




<section id="introduction" class="level1">
<h1>Introduction</h1>
<p>When working with gas systems I make intense use of the <a href="https://www.winccoa.com/documentation/WinCCOA/3.18/en_US/GettingStarted/GettingStarted-60.html">WinCC-OA trending tool</a>, which allows to plot up to 8 time series on the same panel. Each time series tpyically corresponds to the value read by a sensor of a plant so it may have different units and range. The trending tool allows to have multiple Y axes on the left side which can be adjusted in terms of range and offset.</p>
<p>I find this feature particularly helpful, especially when there is the need to quickly and explore and correlate readings of sensor from different parts of the plant</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://grigolet.github.io/posts/plots-with-multiple-y-axes/example_unicos.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">WinCC-OA/UNICOS trending tool</figcaption><p></p>
</figure>
</div>
<p>Tools like matplotlib and plotly make it easy to work with multiple series plotted on the same data but I found a bit cumbersome trying to visualize data having different scales on the same plot.</p>
</section>
<section id="the-problem-of-visualizing-many-series" class="level1">
<h1>The problem of visualizing many series</h1>
<p>Assuming we have a very simple set of <img src="https://latex.codecogs.com/png.latex?(x,%20y_n)"> series a simple plot with matplotlib may look like this:</p>
<div class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb1-1"><span class="im" style="color: #00769E;">import</span> matplotlib.pyplot <span class="im" style="color: #00769E;">as</span> plt</span>
<span id="cb1-2"><span class="im" style="color: #00769E;">import</span> random <span class="im" style="color: #00769E;">as</span> rnd</span>
<span id="cb1-3"></span>
<span id="cb1-4">x <span class="op" style="color: #5E5E5E;">=</span> <span class="bu" style="color: null;">range</span>(<span class="dv" style="color: #AD0000;">100</span>)</span>
<span id="cb1-5">y1 <span class="op" style="color: #5E5E5E;">=</span> [rnd.random() <span class="cf" style="color: #003B4F;">for</span> i <span class="kw" style="color: #003B4F;">in</span> x]</span>
<span id="cb1-6">y2 <span class="op" style="color: #5E5E5E;">=</span> [rnd.random() <span class="op" style="color: #5E5E5E;">*</span> <span class="dv" style="color: #AD0000;">10</span> <span class="cf" style="color: #003B4F;">for</span> i <span class="kw" style="color: #003B4F;">in</span> x]</span>
<span id="cb1-7">y3 <span class="op" style="color: #5E5E5E;">=</span> [rnd.random() <span class="op" style="color: #5E5E5E;">*</span> <span class="dv" style="color: #AD0000;">20</span> <span class="op" style="color: #5E5E5E;">+</span> <span class="dv" style="color: #AD0000;">10</span> <span class="cf" style="color: #003B4F;">for</span> i <span class="kw" style="color: #003B4F;">in</span> x]</span>
<span id="cb1-8">y4 <span class="op" style="color: #5E5E5E;">=</span> [rnd.random() <span class="op" style="color: #5E5E5E;">*</span> <span class="dv" style="color: #AD0000;">100</span> <span class="op" style="color: #5E5E5E;">+</span> <span class="dv" style="color: #AD0000;">50</span> <span class="cf" style="color: #003B4F;">for</span> i <span class="kw" style="color: #003B4F;">in</span> x]</span>
<span id="cb1-9"></span>
<span id="cb1-10">fig, ax <span class="op" style="color: #5E5E5E;">=</span> plt.subplots()</span>
<span id="cb1-11"><span class="cf" style="color: #003B4F;">for</span> y <span class="kw" style="color: #003B4F;">in</span> [y1, y2, y3, y4]:</span>
<span id="cb1-12">    ax.plot(x, y, <span class="st" style="color: #20794D;">'.-'</span>)</span></code></pre></div>
<div class="cell-output cell-output-display">
<div id="fig-multiple-series-same-plot" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="https://grigolet.github.io/posts/plots-with-multiple-y-axes/index_files/figure-html/fig-multiple-series-same-plot-output-1.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;1: A matplotlib plot with four series plotted together.</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>Note that in Figure Figure&nbsp;1 each time series has a different standard deviation, thus different ranges may be needed. This is often easily accomplished by plotting each series in a different subplots. However, subplots make it more difficult to visually compare and align series, especially when time-based. For example, see subplots here:</p>
<div class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb2-1">x <span class="op" style="color: #5E5E5E;">=</span> <span class="bu" style="color: null;">range</span>(<span class="dv" style="color: #AD0000;">100</span>)</span>
<span id="cb2-2">y1 <span class="op" style="color: #5E5E5E;">=</span> [rnd.random() <span class="cf" style="color: #003B4F;">if</span> i <span class="op" style="color: #5E5E5E;">&lt;</span> <span class="dv" style="color: #AD0000;">30</span> <span class="cf" style="color: #003B4F;">else</span> rnd.random() <span class="op" style="color: #5E5E5E;">+</span> <span class="dv" style="color: #AD0000;">1</span> <span class="cf" style="color: #003B4F;">for</span> i <span class="kw" style="color: #003B4F;">in</span> x]</span>
<span id="cb2-3">y2 <span class="op" style="color: #5E5E5E;">=</span> [rnd.random() <span class="op" style="color: #5E5E5E;">*</span> <span class="dv" style="color: #AD0000;">10</span> <span class="cf" style="color: #003B4F;">if</span> i <span class="op" style="color: #5E5E5E;">&lt;</span> <span class="dv" style="color: #AD0000;">33</span> <span class="cf" style="color: #003B4F;">else</span> rnd.random() <span class="op" style="color: #5E5E5E;">*</span> <span class="dv" style="color: #AD0000;">10</span> <span class="op" style="color: #5E5E5E;">+</span> <span class="dv" style="color: #AD0000;">10</span> <span class="cf" style="color: #003B4F;">for</span> i <span class="kw" style="color: #003B4F;">in</span> x]</span>
<span id="cb2-4">y3 <span class="op" style="color: #5E5E5E;">=</span> [rnd.random() <span class="op" style="color: #5E5E5E;">*</span> <span class="dv" style="color: #AD0000;">20</span> <span class="op" style="color: #5E5E5E;">+</span> <span class="dv" style="color: #AD0000;">10</span> <span class="cf" style="color: #003B4F;">if</span> i <span class="op" style="color: #5E5E5E;">&lt;</span> <span class="dv" style="color: #AD0000;">30</span> <span class="cf" style="color: #003B4F;">else</span> rnd.random() <span class="op" style="color: #5E5E5E;">*</span> <span class="dv" style="color: #AD0000;">20</span> <span class="op" style="color: #5E5E5E;">+</span> <span class="dv" style="color: #AD0000;">30</span> <span class="cf" style="color: #003B4F;">for</span> i <span class="kw" style="color: #003B4F;">in</span> x]</span>
<span id="cb2-5">y4 <span class="op" style="color: #5E5E5E;">=</span> [rnd.random() <span class="op" style="color: #5E5E5E;">*</span> <span class="dv" style="color: #AD0000;">100</span> <span class="op" style="color: #5E5E5E;">+</span> <span class="dv" style="color: #AD0000;">50</span> <span class="cf" style="color: #003B4F;">if</span> i <span class="op" style="color: #5E5E5E;">&lt;</span> <span class="dv" style="color: #AD0000;">27</span> <span class="cf" style="color: #003B4F;">else</span> rnd.random() <span class="op" style="color: #5E5E5E;">*</span> <span class="dv" style="color: #AD0000;">100</span> <span class="op" style="color: #5E5E5E;">+</span> <span class="dv" style="color: #AD0000;">180</span> <span class="cf" style="color: #003B4F;">for</span> i <span class="kw" style="color: #003B4F;">in</span> x]</span>
<span id="cb2-6"></span>
<span id="cb2-7">fig, ax <span class="op" style="color: #5E5E5E;">=</span> plt.subplots()</span>
<span id="cb2-8"><span class="cf" style="color: #003B4F;">for</span> y <span class="kw" style="color: #003B4F;">in</span> [y1, y2, y3, y4]:</span>
<span id="cb2-9">    ax.plot(x, y, <span class="st" style="color: #20794D;">'.-'</span>)</span></code></pre></div>
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://grigolet.github.io/posts/plots-with-multiple-y-axes/index_files/figure-html/cell-3-output-1.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Multiple series with an offset at arbitrary x.</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>Here I have added an offset to each series. Two series, <code>y1</code> and <code>y3</code> have a change point at the same index, while the other two have a change point at slightly different <code>x</code>s. We could plot each series in a subplots, perhaps vertically stacked:</p>
<div class="cell" data-execution_count="23">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb3-1">series <span class="op" style="color: #5E5E5E;">=</span> [y1, y2, y3, y4]</span>
<span id="cb3-2">fig, axs <span class="op" style="color: #5E5E5E;">=</span> plt.subplots(<span class="bu" style="color: null;">len</span>(series), <span class="dv" style="color: #AD0000;">1</span>, figsize<span class="op" style="color: #5E5E5E;">=</span>(<span class="dv" style="color: #AD0000;">6</span>, <span class="dv" style="color: #AD0000;">4</span><span class="op" style="color: #5E5E5E;">*</span><span class="bu" style="color: null;">len</span>(series)))</span>
<span id="cb3-3"><span class="cf" style="color: #003B4F;">for</span> ix, y <span class="kw" style="color: #003B4F;">in</span> <span class="bu" style="color: null;">enumerate</span>(series):</span>
<span id="cb3-4">    ax <span class="op" style="color: #5E5E5E;">=</span> axs.flat[ix]</span>
<span id="cb3-5">    ax.plot(x, y, <span class="st" style="color: #20794D;">'.-'</span>)</span>
<span id="cb3-6">    ax.set_title(<span class="ss" style="color: #20794D;">f'y</span><span class="sc" style="color: #5E5E5E;">{</span>ix<span class="op" style="color: #5E5E5E;">+</span><span class="dv" style="color: #AD0000;">1</span><span class="sc" style="color: #5E5E5E;">}</span><span class="ss" style="color: #20794D;">'</span>)</span></code></pre></div>
<div class="cell-output cell-output-display">
<div id="fig-multiple-series-multiple-plots" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="https://grigolet.github.io/posts/plots-with-multiple-y-axes/index_files/figure-html/fig-multiple-series-multiple-plots-output-1.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;2: Series plotted on different subplots.</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>In figure Figure&nbsp;2 you can see that each series as an offset when adding a proper range on the y axis. However, it is still a bit difficult to understand the real indexes of the offset. I would like to understand which come first and which comes later.</p>
</section>
<section id="adding-multiple-y-axes-to-matplotlib-plots" class="level1">
<h1>Adding multiple Y axes to matplotlib plots</h1>
<p>We can starting adding multiple axes by taking inspiration from the Matplotib documentation using <a href="https://matplotlib.org/stable/gallery/spines/multiple_yaxis_with_spines.html">spines</a>, <a href="https://matplotlib.org/stable/gallery/axisartist/demo_parasite_axes.html">Parasite Axes</a> and another <a href="https://matplotlib.org/stable/gallery/axisartist/demo_parasite_axes2.html">Parasite axis</a> demo.</p>
<p>The idea is to use <code>ax.twinx()</code> to create an additional axes. As the <a href="https://matplotlib.org/stable/api/_as_gen/matplotlib.axes.Axes.twinx.html#matplotlib.axes.Axes.twinx">documentation says</a>, &gt; Create a new Axes with an invisible x-axis and an independent y-axis positioned opposite to the original one (i.e.&nbsp;at right).</p>
<p>Although <code>twinx()</code> is used to create a secondary axis on the right position I could use it to create a secondary axis and leave the spines of the axis only on the left. I can use <code>set_position()</code> on the spines object to shift the spines on left:</p>
<div class="cell" data-execution_count="60">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb4-1">fig, ax1 <span class="op" style="color: #5E5E5E;">=</span> plt.subplots()</span>
<span id="cb4-2">ax2 <span class="op" style="color: #5E5E5E;">=</span> ax1.twinx()</span>
<span id="cb4-3">ax3 <span class="op" style="color: #5E5E5E;">=</span> ax1.twinx()</span>
<span id="cb4-4">ax4 <span class="op" style="color: #5E5E5E;">=</span> ax1.twinx()</span>
<span id="cb4-5">axs <span class="op" style="color: #5E5E5E;">=</span> [ax1, ax2, ax3, ax4]</span>
<span id="cb4-6"></span>
<span id="cb4-7"><span class="cf" style="color: #003B4F;">for</span> ix, (ax, y) <span class="kw" style="color: #003B4F;">in</span> <span class="bu" style="color: null;">enumerate</span>(<span class="bu" style="color: null;">zip</span>(axs, series)):</span>
<span id="cb4-8">    ax.plot(x, y, label<span class="op" style="color: #5E5E5E;">=</span><span class="ss" style="color: #20794D;">f'y</span><span class="sc" style="color: #5E5E5E;">{</span>ix<span class="sc" style="color: #5E5E5E;">}</span><span class="ss" style="color: #20794D;">'</span>, color<span class="op" style="color: #5E5E5E;">=</span><span class="ss" style="color: #20794D;">f'C</span><span class="sc" style="color: #5E5E5E;">{</span>ix<span class="sc" style="color: #5E5E5E;">}</span><span class="ss" style="color: #20794D;">'</span>)</span>
<span id="cb4-9">ax.legend()<span class="op" style="color: #5E5E5E;">;</span></span></code></pre></div>
<div class="cell-output cell-output-display">
<div id="fig-single-plot-bare-twinx" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="https://grigolet.github.io/posts/plots-with-multiple-y-axes/index_files/figure-html/fig-single-plot-bare-twinx-output-1.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;3: Single plot with multiple series and secondary axes.</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>As you can see in Figure Figure&nbsp;3 we can understand the index at which each change point of the series is happening. The only issue is that the y axes on the right are overlapping between each other.</p>
<p>My goal is to have these secondary y-axes on the left for easier reading. Actually, if you inspect the source of how <code>twinx()</code> is defined, it calls <code>Axes._make_twin_axes()</code> and sets later the tick position on the right using <code>YAxis.tick_right()</code> and <code>YAxis.set_label_position('right')</code>. It would be nice if <code>twinx()</code> would not assume that we want the axes to the right and instead allowed to pass a parameter which decised the position.</p>
<p>Here below I leave a minimum working example I could think of:</p>
<div class="cell" data-execution_count="54">
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb5-1">fig, axes <span class="op" style="color: #5E5E5E;">=</span> plt.subplots()</span>
<span id="cb5-2"><span class="cf" style="color: #003B4F;">for</span> ix, y <span class="kw" style="color: #003B4F;">in</span> <span class="bu" style="color: null;">enumerate</span>(series):</span>
<span id="cb5-3">    <span class="co" style="color: #5E5E5E;"># If we have to plot the first series we use </span></span>
<span id="cb5-4">    <span class="co" style="color: #5E5E5E;"># The axes created by plt.subplots() earlier</span></span>
<span id="cb5-5">    <span class="cf" style="color: #003B4F;">if</span> ix <span class="op" style="color: #5E5E5E;">==</span> <span class="dv" style="color: #AD0000;">0</span>: </span>
<span id="cb5-6">        ax <span class="op" style="color: #5E5E5E;">=</span> axes</span>
<span id="cb5-7">    <span class="cf" style="color: #003B4F;">else</span>:</span>
<span id="cb5-8">        <span class="co" style="color: #5E5E5E;"># It's not the first series: we need to</span></span>
<span id="cb5-9">        <span class="co" style="color: #5E5E5E;"># create a twin axes</span></span>
<span id="cb5-10">        ax <span class="op" style="color: #5E5E5E;">=</span> axes.twinx()</span>
<span id="cb5-11">    <span class="co" style="color: #5E5E5E;"># Set the ticks of the axis to the left</span></span>
<span id="cb5-12">    ax.yaxis.tick_left()</span>
<span id="cb5-13">    <span class="co" style="color: #5E5E5E;"># Set the labels of the axes to the lef</span></span>
<span id="cb5-14">    ax.yaxis.set_label_position(<span class="st" style="color: #20794D;">'left'</span>)</span>
<span id="cb5-15">    ax.yaxis.set_offset_position(<span class="st" style="color: #20794D;">'left'</span>)</span>
<span id="cb5-16">    <span class="co" style="color: #5E5E5E;"># Offset the position of he ticks and labels</span></span>
<span id="cb5-17">    <span class="co" style="color: #5E5E5E;"># by some % of the axes avoid overlapping of axes</span></span>
<span id="cb5-18">    ax.spines[<span class="st" style="color: #20794D;">'left'</span>].set_position((<span class="st" style="color: #20794D;">'outward'</span>, <span class="dv" style="color: #AD0000;">40</span> <span class="op" style="color: #5E5E5E;">*</span> ix))</span>
<span id="cb5-19">    <span class="co" style="color: #5E5E5E;"># Plot the actual data</span></span>
<span id="cb5-20">    ax.plot(x, y, color<span class="op" style="color: #5E5E5E;">=</span><span class="ss" style="color: #20794D;">f'C</span><span class="sc" style="color: #5E5E5E;">{</span>ix<span class="sc" style="color: #5E5E5E;">}</span><span class="ss" style="color: #20794D;">'</span>)</span>
<span id="cb5-21">    ax.spines[<span class="st" style="color: #20794D;">'left'</span>].set_color(<span class="ss" style="color: #20794D;">f'C</span><span class="sc" style="color: #5E5E5E;">{</span>ix<span class="sc" style="color: #5E5E5E;">}</span><span class="ss" style="color: #20794D;">'</span>)</span>
<span id="cb5-22">    ax.tick_params(axis<span class="op" style="color: #5E5E5E;">=</span><span class="st" style="color: #20794D;">'y'</span>, colors<span class="op" style="color: #5E5E5E;">=</span><span class="ss" style="color: #20794D;">f'C</span><span class="sc" style="color: #5E5E5E;">{</span>ix<span class="sc" style="color: #5E5E5E;">}</span><span class="ss" style="color: #20794D;">'</span>)</span></code></pre></div>
<div class="cell-output cell-output-display">
<p><img src="https://grigolet.github.io/posts/plots-with-multiple-y-axes/index_files/figure-html/cell-6-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>Et voilà, here I have a plot similar to the WinCC-OA one. I could improve the plot a bit by using the same number of ticks for each axes. I would do this using the <code>LinearLocator</code> class:</p>
<div class="cell" data-execution_count="59">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb6-1"><span class="im" style="color: #00769E;">import</span> matplotlib.ticker <span class="im" style="color: #00769E;">as</span> mt</span>
<span id="cb6-2"></span>
<span id="cb6-3">fig, axes <span class="op" style="color: #5E5E5E;">=</span> plt.subplots()</span>
<span id="cb6-4"><span class="cf" style="color: #003B4F;">for</span> ix, y <span class="kw" style="color: #003B4F;">in</span> <span class="bu" style="color: null;">enumerate</span>(series):</span>
<span id="cb6-5">    <span class="co" style="color: #5E5E5E;"># If we have to plot the first series we use </span></span>
<span id="cb6-6">    <span class="co" style="color: #5E5E5E;"># The axes created by plt.subplots() earlier</span></span>
<span id="cb6-7">    <span class="cf" style="color: #003B4F;">if</span> ix <span class="op" style="color: #5E5E5E;">==</span> <span class="dv" style="color: #AD0000;">0</span>: </span>
<span id="cb6-8">        ax <span class="op" style="color: #5E5E5E;">=</span> axes</span>
<span id="cb6-9">    <span class="cf" style="color: #003B4F;">else</span>:</span>
<span id="cb6-10">        <span class="co" style="color: #5E5E5E;"># It's not the first series: we need to</span></span>
<span id="cb6-11">        <span class="co" style="color: #5E5E5E;"># create a twin axes</span></span>
<span id="cb6-12">        ax <span class="op" style="color: #5E5E5E;">=</span> axes.twinx()</span>
<span id="cb6-13">    <span class="co" style="color: #5E5E5E;"># Set the ticks of the axis to the left</span></span>
<span id="cb6-14">    ax.yaxis.tick_left()</span>
<span id="cb6-15">    <span class="co" style="color: #5E5E5E;"># Set the labels of the axes to the left</span></span>
<span id="cb6-16">    ax.yaxis.set_label_position(<span class="st" style="color: #20794D;">'left'</span>)</span>
<span id="cb6-17">    ax.yaxis.set_offset_position(<span class="st" style="color: #20794D;">'left'</span>)</span>
<span id="cb6-18">    <span class="co" style="color: #5E5E5E;"># Offset the position of he ticks and labels</span></span>
<span id="cb6-19">    <span class="co" style="color: #5E5E5E;"># by some % of the axes avoid overlapping of axes</span></span>
<span id="cb6-20">    ax.spines[<span class="st" style="color: #20794D;">'left'</span>].set_position((<span class="st" style="color: #20794D;">'outward'</span>, <span class="dv" style="color: #AD0000;">40</span> <span class="op" style="color: #5E5E5E;">*</span> ix))</span>
<span id="cb6-21">    <span class="co" style="color: #5E5E5E;"># Plot the actual data</span></span>
<span id="cb6-22">    ax.plot(x, y, color<span class="op" style="color: #5E5E5E;">=</span><span class="ss" style="color: #20794D;">f'C</span><span class="sc" style="color: #5E5E5E;">{</span>ix<span class="sc" style="color: #5E5E5E;">}</span><span class="ss" style="color: #20794D;">'</span>)</span>
<span id="cb6-23">    <span class="co" style="color: #5E5E5E;"># Set the colors of the ticks, labels and spines to be</span></span>
<span id="cb6-24">    <span class="co" style="color: #5E5E5E;"># the same of the associated series</span></span>
<span id="cb6-25">    ax.spines[<span class="st" style="color: #20794D;">'left'</span>].set_color(<span class="ss" style="color: #20794D;">f'C</span><span class="sc" style="color: #5E5E5E;">{</span>ix<span class="sc" style="color: #5E5E5E;">}</span><span class="ss" style="color: #20794D;">'</span>)</span>
<span id="cb6-26">    ax.tick_params(axis<span class="op" style="color: #5E5E5E;">=</span><span class="st" style="color: #20794D;">'y'</span>, colors<span class="op" style="color: #5E5E5E;">=</span><span class="ss" style="color: #20794D;">f'C</span><span class="sc" style="color: #5E5E5E;">{</span>ix<span class="sc" style="color: #5E5E5E;">}</span><span class="ss" style="color: #20794D;">'</span>)</span>
<span id="cb6-27">    <span class="co" style="color: #5E5E5E;"># Use a tick locator to have the same number of ticks</span></span>
<span id="cb6-28">    ax.yaxis.set_major_locator(mt.LinearLocator(<span class="dv" style="color: #AD0000;">11</span>))</span>
<span id="cb6-29">    <span class="co" style="color: #5E5E5E;"># And format the labels to have only one digit after the decimals</span></span>
<span id="cb6-30">    ax.yaxis.set_major_formatter(mt.StrMethodFormatter(<span class="st" style="color: #20794D;">'</span><span class="sc" style="color: #5E5E5E;">{x:.1f}</span><span class="st" style="color: #20794D;">'</span>))</span></code></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="https://grigolet.github.io/posts/plots-with-multiple-y-axes/index_files/figure-html/cell-7-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="conclusions" class="level1">
<h1>Conclusions</h1>
<p>I find very useful for myself to provide a minimal example of having a plot with multiple axes, though a final plot may require more subtle adjustements. Keypoints to have multiple y axes:</p>
<ul>
<li>Use <code>twinx()</code> to create an additional axis</li>
<li>Set ticks, labels and offest positions to the right: <code>ax.yaxis.tick_left()</code>, <code>ax.yaxis.set_label_position('left')</code>, <code>ax.yaxis.set_offset_position('left')</code></li>
<li>Adjust the offset of the spines to the left using points, percentage or data coordinate. In the case of points: <code>ax.spines['left'].set_position()</code></li>
<li>Change spines, tick and label colors to the same of the series for better readability: <code>ax.spines['left'].set_color(color)</code>, <code>ax.tick_params(axis='y', colors=color)</code></li>
<li>Optionally adjust the number of ticks to be the same for all the axes: use a <code>LinearLocator</code> class with a fixed number of points</li>
</ul>


</section>

 ]]></description>
  <category>python</category>
  <category>matplotlib</category>
  <category>plot</category>
  <category>visualization</category>
  <guid>https://grigolet.github.io/posts/plots-with-multiple-y-axes/index.html</guid>
  <pubDate>Wed, 07 Sep 2022 22:00:00 GMT</pubDate>
  <media:content url="https://grigolet.github.io/posts/plots-with-multiple-y-axes/preview.png" medium="image" type="image/png" height="72" width="144"/>
</item>
<item>
  <title>A post made from a jupyter notebook</title>
  <dc:creator>Gianluca Rigoletti</dc:creator>
  <link>https://grigolet.github.io/posts/a-post-with-jupyter-notebook/index.html</link>
  <description><![CDATA[ 




<p>Few days ago I found <a href="https://quarto.org">Quarto</a>. I understood it is an authoring framework based on pandoc and that has full support of jupyter notebooks as input files. Since lot of work I carry on at the moment makes a heavy use of jupyter notebook I decided to try Quarto and use it for two main purposes: the first is as a replacement of <code>jupyter nbconvert</code> that I have intensively used to convert notebooks to html pages.</p>
<p>I saw that Quarto provides much more flexibility on the layout of the text, images and code, which was exactly what I was looking for. The second way I intend to use Quarto is to publish the present content. At the time of writing, this post is written on an <code>index.ipynb</code> file in my local computer using Visual Studio code. I find extremely pleasant to write mixed content and have a tool that transforms it in a post page of a blog website.</p>
<p>I will showcase here all the features that I have personally found relevant for the posts I am going to write as well, hoping that this post serves as a quick reference (together with the <a href="https://quarto.org/docs/guide/">Quarto user guide</a>).</p>
<section id="code-cells" class="level2">
<h2 class="anchored" data-anchor-id="code-cells">Code cells</h2>
<p>Code cells are pretty straightforward: I just have to write code in a cell and it will be executed and the output eventually frozen by Quarto. I found the <a href="https://quarto.org/docs/projects/code-execution.html#freeze">freeze option</a> particularly useful and I set it to <code>auto</code> at the time of writing. In this way, the notebooks will be re-rendered only if the source code changes.</p>
<div class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb1-1"><span class="im" style="color: #00769E;">import</span> matplotlib.pyplot <span class="im" style="color: #00769E;">as</span> plt</span>
<span id="cb1-2"><span class="im" style="color: #00769E;">import</span> pandas <span class="im" style="color: #00769E;">as</span> pd </span>
<span id="cb1-3"><span class="im" style="color: #00769E;">import</span> numpy <span class="im" style="color: #00769E;">as</span> np</span></code></pre></div>
</div>
<p>At the very base you can just enter some code and save it. If you are using <code>quarto preview</code> the jupyter notebook is executed when it saved (and not when a code cell is executed, but this depends on the saving options of jupyter).</p>
<p>For instance, we can write some code and let it display some output like this:</p>
<div class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb2-1"><span class="kw" style="color: #003B4F;">class</span> TestClass:</span>
<span id="cb2-2">    <span class="kw" style="color: #003B4F;">def</span> <span class="fu" style="color: #4758AB;">__init__</span>(<span class="va" style="color: #111111;">self</span>, params) <span class="op" style="color: #5E5E5E;">-&gt;</span> <span class="va" style="color: #111111;">None</span>:</span>
<span id="cb2-3">        <span class="va" style="color: #111111;">self</span>.attributes <span class="op" style="color: #5E5E5E;">=</span> params</span>
<span id="cb2-4">    </span>
<span id="cb2-5">    <span class="kw" style="color: #003B4F;">def</span> increment(<span class="va" style="color: #111111;">self</span>, param: <span class="bu" style="color: null;">int</span>) <span class="op" style="color: #5E5E5E;">-&gt;</span> <span class="bu" style="color: null;">int</span>:</span>
<span id="cb2-6">        <span class="cf" style="color: #003B4F;">return</span> param <span class="op" style="color: #5E5E5E;">+</span> <span class="dv" style="color: #AD0000;">1</span></span>
<span id="cb2-7"></span>
<span id="cb2-8">obj <span class="op" style="color: #5E5E5E;">=</span> TestClass(<span class="st" style="color: #20794D;">'test'</span>)</span>
<span id="cb2-9">obj.increment(<span class="dv" style="color: #AD0000;">10</span>)</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="2">
<pre><code>11</code></pre>
</div>
</div>
<p>Sometimes a cell may contain lot of code that makes it difficult for the reader to keep track of the text. In this case folding the code is very helpful and only requires a special comment to be added at the beginning of the code cell:</p>
<div class="sourceCode" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb4-1"><span class="co" style="color: #5E5E5E;">#| code-fold: true</span></span>
<span id="cb4-2"></span>
<span id="cb4-3"><span class="kw" style="color: #003B4F;">class</span> TestClass:</span>
<span id="cb4-4">    <span class="kw" style="color: #003B4F;">def</span> <span class="fu" style="color: #4758AB;">__init__</span>(<span class="va" style="color: #111111;">self</span>, params) <span class="op" style="color: #5E5E5E;">-&gt;</span> <span class="va" style="color: #111111;">None</span>:</span>
<span id="cb4-5">        <span class="va" style="color: #111111;">self</span>.attributes <span class="op" style="color: #5E5E5E;">=</span> params</span>
<span id="cb4-6">    </span>
<span id="cb4-7">    <span class="kw" style="color: #003B4F;">def</span> increment(<span class="va" style="color: #111111;">self</span>, param: <span class="bu" style="color: null;">int</span>) <span class="op" style="color: #5E5E5E;">-&gt;</span> <span class="bu" style="color: null;">int</span>:</span>
<span id="cb4-8">        <span class="cf" style="color: #003B4F;">return</span> param <span class="op" style="color: #5E5E5E;">+</span> <span class="dv" style="color: #AD0000;">1</span></span>
<span id="cb4-9"></span>
<span id="cb4-10">obj <span class="op" style="color: #5E5E5E;">=</span> TestClass(<span class="st" style="color: #20794D;">'test'</span>)</span>
<span id="cb4-11">obj.increment(<span class="dv" style="color: #AD0000;">10</span>)</span></code></pre></div>
<p>Here below the result of the previous snippet of code:</p>
<div class="cell" data-execution_count="3">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb5-1"><span class="kw" style="color: #003B4F;">class</span> TestClass:</span>
<span id="cb5-2">    <span class="kw" style="color: #003B4F;">def</span> <span class="fu" style="color: #4758AB;">__init__</span>(<span class="va" style="color: #111111;">self</span>, params) <span class="op" style="color: #5E5E5E;">-&gt;</span> <span class="va" style="color: #111111;">None</span>:</span>
<span id="cb5-3">        <span class="va" style="color: #111111;">self</span>.attributes <span class="op" style="color: #5E5E5E;">=</span> params</span>
<span id="cb5-4">    </span>
<span id="cb5-5">    <span class="kw" style="color: #003B4F;">def</span> increment(<span class="va" style="color: #111111;">self</span>, param: <span class="bu" style="color: null;">int</span>) <span class="op" style="color: #5E5E5E;">-&gt;</span> <span class="bu" style="color: null;">int</span>:</span>
<span id="cb5-6">        <span class="cf" style="color: #003B4F;">return</span> param <span class="op" style="color: #5E5E5E;">+</span> <span class="dv" style="color: #AD0000;">1</span></span>
<span id="cb5-7"></span>
<span id="cb5-8">obj <span class="op" style="color: #5E5E5E;">=</span> TestClass(<span class="st" style="color: #20794D;">'test'</span>)</span>
<span id="cb5-9">obj.increment(<span class="dv" style="color: #AD0000;">10</span>)</span></code></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="3">
<pre><code>11</code></pre>
</div>
</div>
<p>Note that the output of the cell is not folded. This is particularly useful if you have lot of code printing out a plot for example: the code will be folded but the plot will be visible anyway.</p>
<p>Some other time I wish to completely hide the code while keeping the output visible. In this case the option <code>echo: false</code> does the job:</p>
<div class="sourceCode" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb7-1"><span class="co" style="color: #5E5E5E;">#| echo: false</span></span>
<span id="cb7-2">plt.plot([<span class="dv" style="color: #AD0000;">1</span>,<span class="dv" style="color: #AD0000;">2</span>,<span class="dv" style="color: #AD0000;">3</span>], [<span class="dv" style="color: #AD0000;">4</span>,<span class="dv" style="color: #AD0000;">5</span>,<span class="dv" style="color: #AD0000;">6</span>], <span class="st" style="color: #20794D;">'ro'</span>)<span class="op" style="color: #5E5E5E;">;</span></span></code></pre></div>
<p>Here below the result of the previous snippet of code:</p>
<div class="cell" data-execution_count="4">
<div class="cell-output cell-output-display">
<p><img src="https://grigolet.github.io/posts/a-post-with-jupyter-notebook/index_files/figure-html/cell-5-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>Code cells can be also assigned a file name. This is particularly helpful when there is a post that needs to tackle code among several files. As an example you can have something like:</p>
<div class="sourceCode" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb8-1"><span class="co" style="color: #5E5E5E;">#| filename: test.py</span></span>
<span id="cb8-2"></span>
<span id="cb8-3"><span class="kw" style="color: #003B4F;">class</span> A:</span>
<span id="cb8-4">    <span class="cf" style="color: #003B4F;">pass</span></span></code></pre></div>
<p>And this would be rendered to:</p>
<div class="cell" data-execution_count="5">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>test.py</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb9-1"><span class="kw" style="color: #003B4F;">class</span> A:</span>
<span id="cb9-2">    <span class="cf" style="color: #003B4F;">pass</span></span></code></pre></div>
</div>
</div>
</section>
<section id="controlling-figures-layout" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="controlling-figures-layout">Controlling figures layout</h2>
<p>I find particularly useful the way Quarto helps treating outputs for code cells, especially laying out figures resulting from a code output. Often times I have big plots that I would like to take all the available horizontal space in the page. In this case I can use <code>#| column: page</code> together with on the code cell</p>
<div class="sourceCode" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb10-1"><span class="co" style="color: #5E5E5E;">#| column: page</span></span>
<span id="cb10-2"><span class="co" style="color: #5E5E5E;">#| fig-align: center</span></span>
<span id="cb10-3">fig, ax <span class="op" style="color: #5E5E5E;">=</span> plt.subplots(figsize<span class="op" style="color: #5E5E5E;">=</span>(<span class="dv" style="color: #AD0000;">8</span>, <span class="dv" style="color: #AD0000;">5</span>), dpi<span class="op" style="color: #5E5E5E;">=</span><span class="dv" style="color: #AD0000;">150</span>)</span>
<span id="cb10-4">ax.plot(<span class="bu" style="color: null;">range</span>(<span class="dv" style="color: #AD0000;">10</span>), [<span class="dv" style="color: #AD0000;">1</span>,<span class="dv" style="color: #AD0000;">2</span>,<span class="dv" style="color: #AD0000;">3</span>,<span class="dv" style="color: #AD0000;">2</span>,<span class="dv" style="color: #AD0000;">1</span>,<span class="dv" style="color: #AD0000;">2</span>,<span class="dv" style="color: #AD0000;">2</span>,<span class="dv" style="color: #AD0000;">31</span>,<span class="dv" style="color: #AD0000;">1</span>,<span class="dv" style="color: #AD0000;">2</span>])</span></code></pre></div>
<div class="cell page-columns page-full" data-execution_count="7">
<div class="cell-output cell-output-display column-page">
<p><img src="https://grigolet.github.io/posts/a-post-with-jupyter-notebook/index_files/figure-html/cell-7-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>There is also support for custom layouts when multiple plots are produced. I typically use matplotlib APIs to lay out multiple plots but this features could be useful for images in general and sometimes with libraries where the layout support for subplots is not straightforward. As an example see this snippet:</p>
<div class="sourceCode" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb11-1"><span class="co" style="color: #5E5E5E;">#| layout-ncol: 2</span></span>
<span id="cb11-2"></span>
<span id="cb11-3">fig, ax <span class="op" style="color: #5E5E5E;">=</span> plt.subplots()</span>
<span id="cb11-4">ax.plot([<span class="dv" style="color: #AD0000;">1</span>,<span class="dv" style="color: #AD0000;">2</span>,<span class="dv" style="color: #AD0000;">3</span>,<span class="dv" style="color: #AD0000;">4</span>], [<span class="dv" style="color: #AD0000;">4</span>,<span class="dv" style="color: #AD0000;">3</span>,<span class="dv" style="color: #AD0000;">2</span>,<span class="dv" style="color: #AD0000;">3</span>], <span class="st" style="color: #20794D;">'ro-'</span>)</span>
<span id="cb11-5"></span>
<span id="cb11-6">fig2, ax2 <span class="op" style="color: #5E5E5E;">=</span> plt.subplots()</span>
<span id="cb11-7">ax2.plot([<span class="dv" style="color: #AD0000;">1</span>,<span class="dv" style="color: #AD0000;">2</span>,<span class="dv" style="color: #AD0000;">3</span>,<span class="dv" style="color: #AD0000;">4</span>], [<span class="dv" style="color: #AD0000;">4</span>,<span class="dv" style="color: #AD0000;">3</span>,<span class="dv" style="color: #AD0000;">1</span>,<span class="dv" style="color: #AD0000;">32</span>], <span class="st" style="color: #20794D;">'b*--'</span>)</span></code></pre></div>
<div class="cell quarto-layout-panel" data-execution_count="23">
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="cell-output cell-output-display quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="https://grigolet.github.io/posts/a-post-with-jupyter-notebook/index_files/figure-html/cell-8-output-1.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="https://grigolet.github.io/posts/a-post-with-jupyter-notebook/index_files/figure-html/cell-8-output-2.png" class="img-fluid"></p>
</div>
</div>
</div>
</section>
<section id="conclusions" class="level2">
<h2 class="anchored" data-anchor-id="conclusions">Conclusions</h2>
<p>There are several more features that I think I will be using throughout my journey on this blog. There are also some features related to publications that I want to explore as I would like to understand if I can have some publications ready LaTeX documents from jupyter notebooks</p>
<p>I found Quarto really easy to use and <a href="https://quarto.org/docs/guide/">the documentation</a> is fairly straightforward to follow. I hope to post more interesting findings and customization as I will use it :)</p>


</section>

 ]]></description>
  <category>jupyter</category>
  <category>notebook</category>
  <category>python</category>
  <category>quarto</category>
  <guid>https://grigolet.github.io/posts/a-post-with-jupyter-notebook/index.html</guid>
  <pubDate>Tue, 06 Sep 2022 22:00:00 GMT</pubDate>
</item>
</channel>
</rss>
